<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>HELIX: STAGED COMPILER</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 overflow-hidden font-mono">

<div class="absolute top-6 left-6 z-20 space-y-4 pointer-events-none">
    <div class="bg-white/90 p-4 rounded-2xl shadow-sm border border-slate-200 pointer-events-auto">
        <h1 class="text-xs font-black tracking-widest text-slate-800 uppercase mb-2">Staging Level (Inlining)</h1>
        <input id="stage-slider" type="range" min="0" max="3" step="0.01" value="1.5" class="w-64 h-1 bg-slate-200 accent-blue-600">
        <div class="flex justify-between text-[8px] font-bold text-slate-400 mt-2">
            <span>S3: STATIC</span><span>S2: COMPILED</span><span>S1: RUNTIME</span>
        </div>
    </div>
</div>

<div id="canvas-container" class="w-screen h-screen"></div>

<script>
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf8fafc);
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 2000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    const helixGroup = new THREE.Group();
    scene.add(helixGroup);

    // Параметри за Iivari та mrakgr
    const CONFIG = {
        S3_R: 50, // Рік
        S2_R: 12, // Місяць
        S1_R: 3,  // Година
        drift: 20
    };

    function getPoint(t, alpha) {
        let p = new THREE.Vector3(0, t * CONFIG.drift, 0);

        // STAGE 3 (Yearly Axis) - Static Context
        const a3 = Math.min(Math.max(alpha - 2, 0), 1);
        p.x += Math.cos(t * Math.PI * 0.2) * CONFIG.S3_R * a3;
        p.z += Math.sin(t * Math.PI * 0.2) * CONFIG.S3_R * a3;

        // STAGE 2 (Daily Loops) - Inlined into S3
        const a2 = Math.min(Math.max(alpha - 1, 0), 1);
        const theta2 = t * Math.PI * 2;
        p.x += Math.cos(theta2) * CONFIG.S2_R * a2;
        p.z += Math.sin(theta2) * CONFIG.S2_R * a2;

        // STAGE 1 (Hourly Gradation) - Runtime Detail
        const a1 = Math.min(alpha, 1);
        const theta1 = t * Math.PI * 24;
        p.x += Math.cos(theta1) * CONFIG.S1_R * a1;
        p.z += Math.sin(theta1) * CONFIG.S1_R * a1;

        return p;
    }

    function renderSpiral() {
        helixGroup.clear();
        const alpha = parseFloat(document.getElementById('stage-slider').value);
        const points = [];
        
        // Динамічна роздільна здатність (LOD) - Принцип Spiral
        const segments = alpha > 1.5 ? 3000 : 800; 

        for (let i = 0; i <= segments; i++) {
            points.push(getPoint(i/50, alpha));
        }

        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const material = new THREE.LineBasicMaterial({ 
            color: 0x0f172a, 
            transparent: true, 
            opacity: 0.7 
        });
        const line = new THREE.Line(geometry, material);
        helixGroup.add(line);
    }

    document.getElementById('stage-slider').oninput = renderSpiral;
    camera.position.set(100, 100, 100);
    camera.lookAt(0, 50, 0);

    function animate() {
        requestAnimationFrame(animate);
        helixGroup.rotation.y += 0.002;
        renderer.render(scene, camera);
    }

    renderSpiral();
    animate();
</script>
</body>
</html>
