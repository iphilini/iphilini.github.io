<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>HELIX FLOW: Phase 1</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #0f0f12; /* Темний фон (Void) */
            color: #a9b1d6; /* Термінальний текст */
            font-family: 'Courier New', Courier, monospace;
        }
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
        }
        h1 {
            font-size: 14px;
            margin: 0;
            color: #7aa2f7;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        #status {
            font-size: 12px;
            color: #9ece6a;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div id="ui-layer">
    <h1>Helix Flow // Chrono-Spiral v0.1</h1>
    <div id="status">SYNC: ACTIVE | MODE: HOURLY</div>
    <div id="debug"></div>
</div>

<canvas id="helixCanvas"></canvas>

<script>
    const canvas = document.getElementById('helixCanvas');
    const ctx = canvas.getContext('2d');
    const debugEl = document.getElementById('debug');

    // --- КОНФІГУРАЦІЯ "ВСЕСВІТУ" ---
    let config = {
        centerX: window.innerWidth / 2,
        centerY: window.innerHeight / 2,
        spacing: 30, // Відстань між витками (пікселі)
        lineWidth: 2,
        zoom: 1.0,
        // Масштабування часу: скільки мілісекунд в одному радіані
        // 1 година (3600000 мс) = 1 повний виток (2 * PI)
        timeScale: (1000 * 60 * 60) / (2 * Math.PI) 
    };

    // --- ДАНІ (Імітація Google Calendar API) ---
    // Подія, яка відбудеться через 15 хвилин і триватиме 30 хвилин
    const now = Date.now();
    const events = [
        {
            title: "Daily Sync",
            start: now - (1000 * 60 * 10), // почалася 10 хв тому
            end: now + (1000 * 60 * 20),   // закінчиться через 20 хв
            color: "#bb9af7" // Фіолетовий
        },
        {
            title: "Deep Work",
            start: now + (1000 * 60 * 45), // почнеться через 45 хв
            end: now + (1000 * 60 * 105),  // триватиме годину
            color: "#7aa2f7" // Синій
        }
    ];

    // --- ЯДРО ГЕОМЕТРІЇ ---
    
    // Перетворення часу в кут (Theta)
    // Базова точка (0 радіан) - це початок поточної години, або доби, залежно від масштабу
    function timeToTheta(timestamp) {
        // Опорна точка: початок сьогоднішнього дня (00:00)
        const anchor = new Date().setHours(0,0,0,0);
        const delta = timestamp - anchor;
        return delta / config.timeScale; 
    }

    // Отримання координат (x, y) для заданого часу
    // Використовуємо формулу Архімедової спіралі: r = a + b * theta
    function getSpiralPoint(timestamp) {
        const theta = timeToTheta(timestamp);
        
        // b = config.spacing / (2 * Math.PI)
        // Радіус росте лінійно від кута
        const b = config.spacing / (2 * Math.PI);
        const r = b * theta; 

        // Центруємо спіраль
        const x = config.centerX + r * Math.cos(theta);
        const y = config.centerY + r * Math.sin(theta);
        
        return { x, y, r, theta };
    }

    // --- РЕНДЕРИНГ ---

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        config.centerX = canvas.width / 2;
        config.centerY = canvas.height / 2;
    }

    function drawTimeSegments(startTime, durationHours) {
        // Малюємо "трек" спіралі на n годин вперед і назад
        ctx.beginPath();
        ctx.strokeStyle = '#24283b'; // Темно-синій (колір фонової спіралі)
        ctx.lineWidth = 1;

        const startTheta = timeToTheta(startTime);
        const endTheta = timeToTheta(startTime + durationHours * 3600000);
        
        // Малюємо з кроком (чим менше крок, тим плавніше лінія)
        for (let t = startTime; t <= startTime + durationHours * 3600000; t += 60000) {
            const pos = getSpiralPoint(t);
            if (t === startTime) ctx.moveTo(pos.x, pos.y);
            else ctx.lineTo(pos.x, pos.y);
        }
        ctx.stroke();
    }

    function drawEvent(event) {
        // Малювання події як потовщеної дуги на спіралі
        ctx.beginPath();
        ctx.strokeStyle = event.color;
        ctx.lineWidth = 6;
        ctx.lineCap = "round";

        // Малюємо сегмент
        // Оптимізація: малюємо лініями, для ідеальної кривої треба криві Безьє, 
        // але при малій дискретизації лінії ок.
        for (let t = event.start; t <= event.end; t += 10000) { // крок 10 сек
            const pos = getSpiralPoint(t);
            if (t === event.start) ctx.moveTo(pos.x, pos.y);
            else ctx.lineTo(pos.x, pos.y);
        }
        ctx.stroke();

        // Підпис події (біля початку)
        const startPos = getSpiralPoint(event.start);
        ctx.fillStyle = "#fff";
        ctx.font = "10px monospace";
        ctx.fillText(event.title, startPos.x + 10, startPos.y);
    }

    function drawCursor() {
        const nowPos = getSpiralPoint(Date.now());
        
        // Світіння
        ctx.shadowBlur = 15;
        ctx.shadowColor = "#00ff00"; // Зелений неон
        
        // Точка
        ctx.beginPath();
        ctx.fillStyle = "#00ff00";
        ctx.arc(nowPos.x, nowPos.y, 4, 0, Math.PI * 2);
        ctx.fill();
        
        // Скидаємо ефекти
        ctx.shadowBlur = 0;
        
        // Лінія-вказівник від центру до поточної точки (Радіус-вектор)
        /*
        ctx.beginPath();
        ctx.strokeStyle = "rgba(0, 255, 0, 0.2)";
        ctx.lineWidth = 1;
        ctx.moveTo(config.centerX, config.centerY);
        ctx.lineTo(nowPos.x, nowPos.y);
        ctx.stroke();
        */
    }

    function animate() {
        // Очищення
        ctx.fillStyle = "#0f0f12"; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Цей блок зміщує камеру так, щоб "Зараз" завжди було в центрі екрану?
        // Поки що ні, нехай спіраль буде статичною, а точка рухається.
        // Але щоб спіраль не вилетіла за екран, ми можемо крутити offset.
        
        // 1. Малюємо фонову спіраль (наприклад, останні 12 годин і наступні 12)
        const rangeStart = Date.now() - (12 * 3600000);
        drawTimeSegments(rangeStart, 24);

        // 2. Малюємо події
        events.forEach(evt => drawEvent(evt));

        // 3. Малюємо курсор "Тепер"
        drawCursor();
        
        // Debug Info
        debugEl.innerText = `T: ${new Date().toLocaleTimeString()} | THETA: ${timeToTheta(Date.now()).toFixed(2)}`;

        requestAnimationFrame(animate);
    }

    // Init
    window.addEventListener('resize', resize);
    resize();
    animate();

</script>
</body>
</html>
