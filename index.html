<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Spiral Calendar</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #fff; margin: 0; overflow: hidden; }
        .google-font { font-family: 'Product Sans', sans-serif; }
        .sidebar-item:hover { background-color: #f1f3f4; }
        .active-tab { background-color: #e8f0fe; color: #1a73e8; }
        canvas { outline: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useMemo } = React;

        // --- Константи дизайну Google ---
        const COLORS = {
            blue: '#1a73e8',
            red: '#ea4335',
            yellow: '#fbbc04',
            green: '#34a853',
            gray: '#5f6368',
            spiral: '#dadce0'
        };

        const SpiralCalendar = () => {
            const mountRef = useRef(null);
            const [events, setEvents] = useState([
                { id: 1, title: 'Ранкова кава', hour: 9, color: COLORS.yellow },
                { id: 2, title: 'Sync-up Meeting', hour: 11, color: COLORS.blue }
            ]);
            const [params, setParams] = useState({ radius: 7, turns: 1.2, height: 14 });

            // --- 3D Engine Оптимізація ---
            useEffect(() => {
                const container = mountRef.current;
                const scene = new THREE.Scene();
                scene.background = new THREE.Color('#ffffff');

                const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.set(18, 12, 18);

                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(container.clientWidth, container.clientHeight);
                container.appendChild(renderer.domElement);

                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;

                // Створення спіралі
                const getPos = (h) => {
                    const t = h / 24;
                    const angle = t * 2 * Math.PI * params.turns;
                    return new THREE.Vector3(
                        Math.cos(angle) * params.radius,
                        (0.5 - t) * params.height, // Інверсія, щоб 00:00 було зверху
                        Math.sin(angle) * params.radius
                    );
                };

                // Основна лінія часу
                const curvePoints = [];
                for(let i=0; i<=48; i++) curvePoints.push(getPos(i/2));
                const curve = new THREE.CatmullRomCurve3(curvePoints);
                const tubeGeom = new THREE.TubeGeometry(curve, 100, 0.05, 8, false);
                const tubeMat = new THREE.MeshBasicMaterial({ color: COLORS.spiral });
                scene.add(new THREE.Mesh(tubeGeom, tubeMat));

                // Крапки годин з градієнтом
                for(let h=0; h<24; h++) {
                    const dotPos = getPos(h);
                    const dotGeom = new THREE.SphereGeometry(0.15, 16, 16);
                    let col = COLORS.gray;
                    if(h >= 7 && h <= 10) col = COLORS.yellow;
                    if(h > 10 && h <= 18) col = COLORS.blue;
                    
                    const dotMat = new THREE.MeshBasicMaterial({ color: col });
                    const dot = new THREE.Mesh(dotGeom, dotMat);
                    dot.position.copy(dotPos);
                    scene.add(dot);
                }

                // Візуалізація подій на спіралі
                events.forEach(ev => {
                    const evPos = getPos(ev.hour);
                    const evGeom = new THREE.SphereGeometry(0.4, 32, 32);
                    const evMat = new THREE.MeshPhongMaterial({ color: ev.color, shininess: 100 });
                    const sphere = new THREE.Mesh(evGeom, evMat);
                    sphere.position.copy(evPos);
                    scene.add(sphere);
                    
                    // Світіння навколо події
                    const light = new THREE.PointLight(ev.color, 0.5, 3);
                    light.position.copy(evPos);
                    scene.add(light);
                });

                // Поточний час
                const now = new Date();
                const curH = now.getHours() + now.getMinutes()/60;
                const curMarker = new THREE.Mesh(
                    new THREE.SphereGeometry(0.3, 16, 16),
                    new THREE.MeshBasicMaterial({ color: COLORS.red })
                );
                curMarker.position.copy(getPos(curH));
                scene.add(curMarker);

                const animate = () => {
                    requestAnimationFrame(animate);
                    controls.update();
                    const s = 1 + Math.sin(Date.now() * 0.003) * 0.2;
                    curMarker.scale.set(s, s, s);
                    renderer.render(scene, camera);
                };
                animate();

                return () => {
                    renderer.dispose();
                    if (container.contains(renderer.domElement)) container.removeChild(renderer.domElement);
                };
            }, [events, params]);

            return (
                <div className="flex h-screen w-full text-[#3c4043]">
                    {/* Google Sidebar */}
                    <aside className="w-64 border-r flex flex-col p-4 gap-4">
                        <div className="flex items-center gap-2 px-2 mb-4">
                            <div className="w-8 h-8 bg-blue-500 rounded-lg"></div>
                            <span className="google-font text-xl font-medium">Calendar</span>
                        </div>
                        
                        <button className="flex items-center gap-3 shadow-md border rounded-full px-6 py-3 hover:shadow-lg transition-all w-fit">
                            <span className="text-2xl">+</span> <span className="font-medium text-sm">Створити</span>
                        </button>

                        <div className="mt-4">
                            <div className="sidebar-item active-tab flex items-center gap-3 p-2 px-4 rounded-r-full cursor-pointer text-sm font-medium">
                                <span>3D Спіраль</span>
                            </div>
                            <div className="sidebar-item flex items-center gap-3 p-2 px-4 rounded-r-full cursor-pointer text-sm">
                                <span>День</span>
                            </div>
                        </div>

                        <div className="mt-auto p-4 bg-gray-50 rounded-xl space-y-3">
                            <p className="text-[11px] uppercase font-bold text-gray-500 tracking-wider">Параметри виду</p>
                            <input type="range" className="w-full" min="5" max="15" value={params.radius} onChange={e => setParams({...params, radius: +e.target.value})} />
                            <input type="range" className="w-full" min="0.5" max="2" step="0.1" value={params.turns} onChange={e => setParams({...params, turns: +e.target.value})} />
                        </div>
                    </aside>

                    {/* Main Content Area */}
                    <main className="flex-1 flex flex-col">
                        {/* Header Bar */}
                        <header className="h-16 border-b flex items-center justify-between px-6">
                            <div className="flex items-center gap-4">
                                <button className="p-2 hover:bg-gray-100 rounded-full">Today</button>
                                <h2 className="text-xl google-font">Січень 2026</h2>
                            </div>
                            <div className="flex gap-2">
                                <button className="border rounded px-4 py-1.5 text-sm font-medium hover:bg-gray-50">Тиждень</button>
                            </div>
                        </header>

                        <div className="flex-1 relative">
                            <div ref={mountRef} className="w-full h-full"></div>
                            
                            {/* Overlay List of Events */}
                            <div className="absolute top-6 right-6 w-72 bg-white/80 backdrop-blur shadow-2xl rounded-2xl p-4 border">
                                <h3 className="font-medium mb-4">Розклад на сьогодні</h3>
                                {events.map(ev => (
                                    <div key={ev.id} className="flex items-center gap-3 p-2 mb-2 rounded-lg hover:bg-white transition-colors">
                                        <div className="w-3 h-3 rounded-full" style={{backgroundColor: ev.color}}></div>
                                        <div className="text-sm">
                                            <div className="font-medium">{ev.title}</div>
                                            <div className="text-gray-500">{ev.hour}:00</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpiralCalendar />);
    </script>
</body>
</html>
