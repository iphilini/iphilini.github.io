<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiral Calendar Pro 3D</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #f8f9fa; }
        #root { height: 100vh; }
        .control-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useMemo } = React;

        const SpiralCalendar = () => {
            const mountRef = useRef(null);
            const [view, setView] = useState('3d');
            
            // Параметри спіралі
            const [radius, setRadius] = useState(8);      // Амплітуда
            const [frequency, setFrequency] = useState(1); // Частота (витків)
            const [height, setHeight] = useState(15);     // Висота

            // --- 3D Сцена ---
            useEffect(() => {
                if (view !== '3d' || !mountRef.current) return;

                const container = mountRef.current;
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf8f9fa);

                const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.set(15, 15, 25);

                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                container.appendChild(renderer.domElement);

                // Додаємо OrbitControls для обертання та зуму
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;

                // Функція розрахунку кольору градієнта (Ніч -> Ранок -> День -> Вечір)
                const getHourColor = (h) => {
                    if (h >= 5 && h < 9) return new THREE.Color('#ffcc33'); // Світанок
                    if (h >= 9 && h < 17) return new THREE.Color('#4285f4'); // День
                    if (h >= 17 && h < 21) return new THREE.Color('#f4b400'); // Захід
                    return new THREE.Color('#202124'); // Ніч
                };

                const getSpiralPos = (h) => {
                    const t = h / 24;
                    const angle = t * 2 * Math.PI * frequency;
                    return new THREE.Vector3(
                        Math.cos(angle) * radius,
                        (t - 0.5) * height,
                        Math.sin(angle) * radius
                    );
                };

                // Малювання спіралі (лінія)
                const points = [];
                for(let i=0; i<=240; i++) points.push(getSpiralPos(i/10));
                const lineGeom = new THREE.BufferGeometry().setFromPoints(points);
                const lineMat = new THREE.LineBasicMaterial({ color: 0xdadce0, transparent: true, opacity: 0.5 });
                const spiralLine = new THREE.Line(lineGeom, lineMat);
                scene.add(spiralLine);

                // Точки годин з градієнтом
                const dotsGroup = new THREE.Group();
                for(let h=0; h<24; h++) {
                    const pos = getSpiralPos(h);
                    const color = getHourColor(h);
                    const dotGeom = new THREE.SphereGeometry(0.25, 16, 16);
                    const dotMat = new THREE.MeshBasicMaterial({ color });
                    const dot = new THREE.Mesh(dotGeom, dotMat);
                    dot.position.copy(pos);
                    dotsGroup.add(dot);
                }
                scene.add(dotsGroup);

                // Поточний час (акцентна точка)
                const now = new Date();
                const curH = now.getHours() + now.getMinutes()/60;
                const curPos = getSpiralPos(curH);
                const curGeom = new THREE.SphereGeometry(0.5, 32, 32);
                const curMat = new THREE.MeshBasicMaterial({ color: 0xea4335 });
                const curMarker = new THREE.Mesh(curGeom, curMat);
                curMarker.position.copy(curPos);
                scene.add(curMarker);

                const animate = () => {
                    requestAnimationFrame(animate);
                    controls.update();
                    // Легка пульсація поточного часу
                    const s = 1 + Math.sin(Date.now() * 0.005) * 0.2;
                    curMarker.scale.set(s, s, s);
                    renderer.render(scene, camera);
                };
                animate();

                const handleResize = () => {
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeight);
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    renderer.dispose();
                    if (container.contains(renderer.domElement)) container.removeChild(renderer.domElement);
                };
            }, [view, radius, frequency, height]);

            return (
                <div className="flex h-full w-full">
                    {/* Ліва панель керування */}
                    <div className="w-80 border-r bg-white p-6 flex flex-col gap-6 shadow-lg z-10">
                        <h1 className="text-xl font-bold text-blue-600">Spiral Calendar</h1>
                        
                        <div className="flex bg-gray-100 p-1 rounded-lg">
                            <button onClick={() => setView('3d')} className={`flex-1 py-2 rounded ${view === '3d' ? 'bg-white shadow' : ''}`}>3D Сцена</button>
                            <button onClick={() => setView('list')} className={`flex-1 py-2 rounded ${view === 'list' ? 'bg-white shadow' : ''}`}>Список</button>
                        </div>

                        <div className="space-y-4">
                            <h3 className="font-semibold text-gray-700">Налаштування спіралі</h3>
                            
                            <label className="block text-sm">
                                Амплітуда (Радіус): {radius}
                                <input type="range" min="2" max="15" step="0.5" value={radius} 
                                    onChange={(e) => setRadius(parseFloat(e.target.value))} className="w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer mt-2" />
                            </label>

                            <label className="block text-sm">
                                Частота (Витки): {frequency}
                                <input type="range" min="0.5" max="3" step="0.1" value={frequency} 
                                    onChange={(e) => setFrequency(parseFloat(e.target.value))} className="w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer mt-2" />
                            </label>

                            <label className="block text-sm">
                                Висота: {height}
                                <input type="range" min="5" max="30" step="1" value={height} 
                                    onChange={(e) => setHeight(parseFloat(e.target.value))} className="w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer mt-2" />
                            </label>
                        </div>

                        <div className="mt-auto text-xs text-gray-400">
                            Використовуйте мишу для обертання та колесо для зуму
                        </div>
                    </div>

                    {/* Основний перегляд */}
                    <div className="flex-1 relative">
                        {view === '3d' ? (
                            <div ref={mountRef} className="w-full h-full cursor-move"></div>
                        ) : (
                            <div className="p-10 overflow-y-auto h-full bg-white">
                                <h2 className="text-2xl font-bold mb-6">Погодинний план</h2>
                                {[...Array(24)].map((_, i) => (
                                    <div key={i} className="flex border-b py-4 items-center">
                                        <span className="w-20 font-mono text-gray-500">{i}:00</span>
                                        <div className="flex-1 h-8 bg-gray-50 rounded"></div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpiralCalendar />);
    </script>
</body>
</html>
