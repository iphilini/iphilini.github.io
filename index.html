<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HELIX: SLM ANCHOR</title>
    <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <style>
        body { margin: 0; background: #020508; overflow: hidden; font-family: 'Courier New', monospace; }
        #ui { position: absolute; top: 20px; left: 20px; z-index: 100; background: rgba(0,20,40,0.8); padding: 15px; border: 1px solid #00d2ff; color: #00d2ff; }
        input { width: 250px; }
    </style>
</head>
<body>
    <div id="ui">
        > SLM_DECODING_ACTIVE<br>
        > FOCUS_INDEX: <span id="idx">0</span><br>
        > TIMELINE_POS: <input id="time-slider" type="range" min="0" max="2.5" step="0.001" value="0.5">
    </div>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Grid
        scene.add(new THREE.GridHelper(100, 50, 0x001122, 0x001122));

        const helixGroup = new THREE.Group();
        scene.add(helixGroup);

        // Якір SLM (The Anchor Token)
        const anchorGeo = new THREE.SphereGeometry(0.5, 32, 32);
        const anchorMat = new THREE.MeshBasicMaterial({ color: 0xff0044 });
        const anchor = new THREE.Mesh(anchorGeo, anchorMat);
        scene.add(anchor);

        // Математика (Iivari + Spiral)
        function getPos(t) {
            const alpha = 1.5; // Фіксуємо для наочності
            let x = Math.cos(t * Math.PI * 2) * 12;
            let z = Math.sin(t * Math.PI * 2) * 12;
            let y = t * 15;
            
            // Додаємо годинну фазу
            x += Math.cos(t * Math.PI * 48) * 2;
            z += Math.sin(t * Math.PI * 48) * 2;
            
            return new THREE.Vector3(x, y, z);
        }

        // Рендер спіралі
        const points = [];
        for (let t = 0; t < 2.5; t += 0.005) points.push(getPos(t));
        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const material = new THREE.LineBasicMaterial({ color: 0x00d2ff, opacity: 0.4, transparent: true });
        const mainLine = new THREE.Line(geometry, material);
        helixGroup.add(mainLine);

        function update() {
            const t = parseFloat(document.getElementById('time-slider').value);
            const pos = getPos(t);
            
            // Рух якоря
            anchor.position.copy(pos);
            document.getElementById('idx').innerText = (t * 24).toFixed(2) + "h";

            // Камера слідує за фокусом (Smooth Follow)
            camera.position.lerp(new THREE.Vector3(pos.x + 20, pos.y + 10, pos.z + 20), 0.05);
            camera.lookAt(pos);
        }

        // Початкова позиція камери
        camera.position.set(40, 40, 40);

        function animate() {
            requestAnimationFrame(animate);
            update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
